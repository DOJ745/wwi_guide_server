extends ../basic_layout

block content
    div.container.h-100
        div.row.align-items-center.justify-content-center.h-100
            img.col.img-thumbnail.w-25.m-1(src="https://sun1-30.userapi.com/c851320/v851320146/1f543f/dDRICq8Lv8A.jpg")
            form#myForm.col-6.w-25(
                action="http://localhost:5000/api.wwi-guide.by/auth/login"
                method="POST")
                h1.text-center Time to write some guides
                div.form-group
                    label.form-label(for='loginField') Login
                    input#loginField.form-control(
                        type='text'
                        name='login'
                        placeholder='Username'
                        required=''
                        minlength=4
                        maxlength=48)
                div.form-group
                    label.form-label(for='passwordField') Password
                    input#passwordField.form-control(
                        type='password'
                        name='password'
                        required=''
                        minlength=6
                        maxlength=18)
                div.form-check
                    input#rememberMe.form-check-input(
                        type='checkbox'
                        name='remember')
                    label.form-check-label(for='rememberMe')
                        | Remember me
                div.row.form-group
                    p#response(hidden='' style='color: red') Error response
                div.row.form-signin
                    //button#btnSubmit.col.btn.btn-primary.m-1(type='button') Sign in
                    button#btnSubmit.col.btn.btn-primary.m-1(type='submit') Sign in
                    a.col.btn.btn-primary.m-1(href='http://localhost:5000/reg' role='button') Sign up

    script(type='text/javascript').
        $(document).ready(function() {

            /*
            $("#btnSubmit").click(function () {

                //let isValid
                //isValid = loginForm.checkValidity()

                const loginForm = $("#myForm")
                const loginField = $("#loginField")
                const passwordField = $("#passwordField")
                const rememberMeBox = $("#rememberMe")

                let formData

                formData = {
                    "login": loginField.val(),
                    "password": passwordField.val(),
                    "remember": rememberMeBox.checked
                }
                $.ajax({
                    url: loginForm.attr('action'),
                    type: loginForm.attr('method'),
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                }).done((res) => {})
                    .fail((jqXHR) => {
                    let responseMsg = $("#response")
                    let errorData = $.parseJSON(jqXHR.responseText)
                    responseMsg.html(errorData.message)
                    responseMsg.removeAttr('hidden')
                })
            });*/

            const loginForm = $("#myForm");

            let validateForm = function (event) {

                const loginField = $("#loginField")
                const passwordField = $("#passwordField")
                const rememberMeBox = $("#rememberMe")

                let formData = {
                    "login": loginField.val(),
                    "password": passwordField.val(),
                    "remember": rememberMeBox.checked
                }

                $.ajax({
                    url: loginForm.attr('action'),
                    type: loginForm.attr('method'),
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                }).done((res) => {
                })
                    .fail((jqXHR) => {
                        let responseMsg = $("#response")
                        let errorData = $.parseJSON(jqXHR.responseText)
                        responseMsg.html(errorData.message)
                        responseMsg.removeAttr('hidden')
                    })

                event.preventDefault();
            };

            loginForm[0].addEventListener("submit", validateForm, true);
        })